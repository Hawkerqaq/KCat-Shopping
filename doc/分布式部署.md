# 项目部署

#### 环境部署

M：需要启动什么环境？

Z：zookeeper，nginx，

rabbitMQ

```
rabbitmq.host=127.0.0.1
rabbitmq.port=5672
```

dubbo-admin

```
SHUTDOWN   8006
port	   8081		redirectPort  8446
port	   8010		redirectPort  8446
```

#### taotao-manage(A)

Z：直接部署tomcatA，访问地址 http://127.0.0.1:8080/rest/page/index  

```
SHUTDOWN   8015
port	   8084		redirectPort  8453
port	   8019		redirectPort  8453
```

#### taotao-sso-query-service     提供者(B)

Z：部署tomcatB

```
SHUTDOWN   8108
port	   8184		redirectPort  8547
port	   8213		redirectPort  8547
```

#### taotao-web    消费者(B)

Z：部署tomcatC

```
SHUTDOWN   8106
port	   8584		redirectPort  8545
port	   8211		redirectPort  8545
```

M：为什么启动不起来呢？

Z：从dubbo观察提供者和消费者的状态。

M：服务和应用都正常，但是tomcat却访问不了，怎么做？

Z：只能尝试从设计的层面进行研究，两者是如何实现通信的。

M：处理rabbitMQ问题之后，没有任何报错了，还是访问不了主页。怎么办？

Z：发现源码中通过域名来访问接口，而本机是实现不了域名访问的，所以修改域名为ip:port

M：修改域名为ip:port，并且将发布tomcat的项目名去掉。

1. tomcat校对预定的端口

```
TAOTAO_MANAGE_URL=http://127.0.0.1:8084
TAOTAO_SSO_URL=http://127.0.0.1:8184
TAOTAO_ORDER_URL=http://127.0.0.1:8284
TAOTAO_CART_URL=http://127.0.0.1:8384
IMAGE_BASE_URL=http://127.0.0.1:8484
TAOTAO_WEB_URL=http://127.0.0.1:8584
```

2. tomcat去掉访问项目名   ``		<Context path="/" docBase="taotao-manage"></Context>``  

3. 修改env.properties    

D：到这里就成功实现web前端页面的访问   

#### taotao-upload.tar

M：怎么解决访问远程图片呢？

Z：可以单独部署图片服务器，也可以使用网络文件系统NFS（文件夹共享）。

####taotao-sso  

Z：部署在tomcatD上

```  
SHUTDOWN   8109
port	   8684		redirectPort  8549
port	   8220		redirectPort  8549
```

M：访问地址是什么？

Z：``ip:port/user/login.html``

M：但是为什么没有显示登陆页面的图片呢？

Z：静态文件访问的问题

M：怎么指定图片的访问地址呢？

Z：查看源码，发现是register.jsp和login.jsp写死了ip地址，修改为tomcat下即可

```java
<%
	String staticUrl = "/taotao-static";
	request.setAttribute("staticUrl", staticUrl);
%>
```

M：注册不了，登陆又需要账号，怎么办？

Z：查看登陆逻辑，直接往数据库插入数据。

查了数据库发现有zhangsan   密码123456

M：还是登陆不了，怎么办？

Z：查看登陆逻辑。

M：我看编译后的源码，sso系统自己就执行了查询操作，但是到Mapper接口层就消失了，是编译没有带出来呢，还是用其他的什么方式进行查询。

Z：查看视频登陆逻辑的制作功能。

M：发现是单独服务的逻辑，不知原因无法启动暂时跳过。

Z：solr是linux版本的，暂时不做部署，为此搜索页面，详情页面也展现不了。









做最详细的笔记，研究完研究微服务。



#### dubbo服务   

M：dubbo服务在本项目中是怎么使用的呢？我能想到的只有sso那个步骤。   

Z：



#### solr

M：solr在本项目中是怎么使用的呢？





#### 购物车

M：购物车效果是怎么实现的呢？通过操作cookie吗。







#### nginx

M：nginx在本项目中的角色是怎么样的呢？







#### RabbitMQ

M：在本项目中，RabbitMQ怎么起到它的作用的呢？

Z：对商品内容的修改可以实时更新。   





#### keeplive

M：keeplive怎么使用？

Z：使用虚拟ip，指向两个nginx的第一个。











下一个 17solr 的部署

部署完新版  -->   整理部署旧版taotao  编写部署仓库















   



















目前使用本地环境进行部署，启动：rabbitMQ，nginx，redis，zookeeper

修改host

tomcat启动多个项目基本没有太大压力，但是由于多个页面首页可能存在冲突，还是要分开多个tomcat来，修改配置文件。

M：现在有什么疑问比较大的地方？

Z：通过host来映射域名，但是部署在本机情况下是用端口来区分的，怎么处理这个问题？

D：尝试从原理入手，修改域名连接为ip:port连接的方式



### 

---





### taotao-manage

修改taotao-manage配置文件

1. env.properties   

   数据库地址改为同一个

2. rabbitmq.properties   

   修改其地址

3. redis.properties

tomcat启动，  ip:port/rest/page/index  

### rabbitMQ   

能够ping主机才能启动，修改host:  vim /etc/hosts，添加``127.0.0.1 itcast01``  

上传rabbit ，启动，查看状态   

启动管理工具命令，重启``service rabbitmq-server restart``

需要开放端口之后就能远程登陆

guest，guest进行访问

登陆失败。开通远程登陆权限，修改rabbit配置文件

重启服务，即可登陆

内部操作：admin中创建用户taotao，taotao，administrator。在Virtual hosts中添加需host为taotao，并且授权Set permision，即可用taotao用户登录了

### dubbo-monitor   

进入conf中，修改dubbo.properties   

修改注册中心的地址，修改jetty.port为8088

启动即可直接访问

### taotao-web-1

env.properties默认地址   

rabbitMQ

redis

dubbo中的配置文件

（启动会受到sso-query的牵制，其没启动会报错）  

 添加host   192.168.50.23 manage.taotao.com

首页就可以正常访问了

###taotao-SSO-query  

打开redis.properties有文件冲突，用``ll -a``查看所有文件，删除其相关的冲突文件（.开头的）,即可成功打开redis.properties。

dubbo-admin显示没有提供者，dubbo的配置文件20880暴露端口，没有开启被访问的权限。

启动tomcat



### nginx

修改配置文件   

访问域名

1.修改本地host     switchHosts   域名转发ip





视频14



---



12天视频10粗略跳过：

SOA：面向服务的架构   

WebService：系统之间通过接口调用

redis，nosql，solr，nginx

Mysql分布分表中间件：cobar，实现集群，现在叫MyCat

一个ip要访问多个服务，需要反向代理，用nginx。



Nginx：   

图片服务器，负载均衡。  

虚拟主机：根据域名对访问进行区分。     

反向代理：我访问这个网站，哪个服务器来为我服务。决定请求转发给哪个服务器。   



nginx需要进行编译安装，linux的操作。

通过修改host文件可以设置访问的域名。   

   

13天视频粗略过   

一个虚拟机启动两个tomcat，关闭防火墙，就可以进行访问。   

配置nginx的host，让一个80端口被多个服务器使用。    

这样就可以通过域名访问到tomcat    

配置对访问的域名拦截，然后进行转发给别的服务器。nginx实际就是做拦截转发的功能。      



同一个域名多台服务器提供服务，需要nginx的负载均衡。

根据服务器的性能调整访问的权重。    

nginx高可用，单点故障很危险。解决方案：添加冗余，加备份机。备份机实时监控备机，使用keepalived：不断对主服务器nginx进行健康检查。   

主机挂了之后，备用机把虚拟ip绑定到自己身上，保持网站正常访问。   



solr集群   

SolrCloud提供分布式搜索方案   





ZooKeeper是一个程序协调服务：

配置管理，集群管理







   



   









